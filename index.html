<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>The Visual Wizard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --bg1: #0a0f1f;
  --bg2: #0c1224;
  --card: #0d162e;
  --accent1: #00c6ff;
  --accent2: #00e676;
  --text: #e4edf7;
  --muted: #94a3b8;
  --error: #ff6b6b;
  --success: #4ade80;
}

/* GLOBAL */
body {
  margin:0; padding:0;
  font-family: "Inter", system-ui, sans-serif;
  background: linear-gradient(180deg, var(--bg2), var(--bg1));
  color:var(--text);
}

/* HEADER */
header {
  padding:1.5rem 2rem;
  display:flex; justify-content:space-between; align-items:center;
}

header h1 {
  font-size:2.6rem; font-weight:700;
  color:#22d3ee;
  margin:0;
}

header small {
  color:#b4c7ff; font-size:1rem;
}

/* LAYOUT */
main { max-width:1250px;margin:auto;padding:2rem 1rem; }
.grid-3 { display:grid; grid-template-columns:repeat(3,1fr); gap:1.8rem; }

/* CARD */
.card {
  padding:1.5rem;
  border-radius:20px;
  background:var(--card);
  box-shadow:0 8px 25px rgba(0,0,0,0.45);
  border:1px solid rgba(255,255,255,0.08);
}

h2 { margin-top:0; font-size:1.6rem; color:#f3faff; }

/* BUTTONS */
button {
  padding:.75rem 1.6rem;
  border:none; border-radius:50px;
  font-size:1rem;font-weight:600;
  cursor:pointer;transition:.25s;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  color:#001;
  margin-top:10px;
}

button:hover { transform:scale(1.05); filter:brightness(1.15); }

button.secondary {
  background:transparent;color:var(--muted);
  border:1px solid var(--muted);
}

/* INPUT */
input[type="text"], input[type="file"] {
  width:100%;
  padding:.7rem;
  font-size:1rem;
  border-radius:12px;
  background:#0f1a33;
  border:2px solid white;
  color:white;
}

/* STATUS */
#uploadStatus, #searchStatus {
  margin-top:.4rem;
  font-size:.9rem;
}
.success { color:var(--success); }
.error { color:var(--error); }

/* RESULTS GRID */
.gallery-grid {
  margin-top:1.2rem;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:1.25rem;
}

.image-card {
  background:#0e1a34;
  border-radius:14px;
  border:1px solid rgba(255,255,255,0.12);
  padding:.6rem;
  text-align:center;
}

.image-card img {
  width:100%; height:260px;
  object-fit:contain;
  border-radius:12px;
  background:#000;
}

.label-pill {
  display:inline-block;
  background:rgba(0,230,118,.2);
  color:var(--accent2);
  padding:.25rem .55rem;
  border-radius:999px;
  margin:3px;
}

footer {
  padding:1rem;text-align:center;color:var(--muted);
  margin-top:2rem;
  border-top:1px solid rgba(255,255,255,0.1);
}
</style>
</head>

<body>

<header>
  <h1>The Visual Wizard</h1>
  <small>S3 + Lambda + API + DynamoDB</small>
</header>

<main>
<section class="grid-3">

  <div class="card">
    <h2>1. Upload Image</h2>
    <p>Upload an image to S3</p>
    <label>Choose image file</label>
    <input id="fileInput" type="file" accept="image/*"/>
    <button onclick="uploadImage()">‚¨Ü Upload to S3</button>
    <div id="uploadStatus"></div>
  </div>

  <div class="card">
    <h2>2. Search by Tag</h2>
    <input id="searchTag" type="text" placeholder="e.g., dog"/>
    <button onclick="searchByTag()">üîç Search</button>
    <button class="secondary" onclick="clearSearch()">Clear</button>
    <div id="searchStatus"></div>
  </div>

  <div class="card">
    <h2>3. Image Gallery</h2>
    <button onclick="openGallery()">üñº Load Gallery</button>
  </div>

</section>

<h2>Results</h2>
<span id="resultsContext" class="pill">Waiting for search or gallery...</span>
<div id="resultsGrid" class="gallery-grid"></div>

</main>

<footer>Built on AWS ¬∑ The Visual Wizard</footer>

<script>
const CONFIG = {
  apiBaseUrl: "https://xgsl7euy9f.execute-api.us-east-1.amazonaws.com/prod",
  photosBucketBaseUrl: "https://visual-wizard-051826730831-photos.s3.amazonaws.com"
};


function setStatus(id,msg){ document.getElementById(id).textContent = msg; }

async function uploadImage(){
  const file=document.getElementById("fileInput").files[0];
  if(!file) return setStatus("uploadStatus","‚ö† Select a file");
  const key=`images/${Date.now()}_${file.name.replace(/\s+/g,"_")}`;
  const url=`${CONFIG.photosBucketBaseUrl}/${encodeURIComponent(key)}`;
  setStatus("uploadStatus","Uploading...");
  const res=await fetch(url,{ method:"PUT", headers:{ "Content-Type":file.type }, body:file });
  setStatus("uploadStatus",res.ok?"Upload success":"Upload failed: "+res.status);
}

async function searchByTag(){
  const tag=document.getElementById("searchTag").value.trim();
  if(!tag) return setStatus("searchStatus","Enter a tag");
  const res=await fetch(`${CONFIG.apiBaseUrl}/search?tag=${encodeURIComponent(tag)}`);
  const data=await res.json();
  renderImages(data.results);
  document.getElementById("resultsContext").textContent=`Search results: "${tag}"`;
}

function clearSearch(){
  document.getElementById("searchTag").value="";
  document.getElementById("resultsGrid").innerHTML="";
  document.getElementById("resultsContext").textContent="Waiting for search...";
}

function openGallery(){ window.open("gallery.html","_blank"); }

function renderImages(items){
  const grid=document.getElementById("resultsGrid");
  grid.innerHTML="";
  items.forEach(item=>{
    const url=item.image_url || `${CONFIG.photosBucketBaseUrl}/${item.object_key}`;
    grid.innerHTML+=`
      <div class="image-card">
        <img src="${url}"/>
        <div>${item.labels?.map(l=>`<span class='label-pill'>${l}</span>`).join("")}</div>
      </div>`;
  });
}
</script>

</body>
</html>
